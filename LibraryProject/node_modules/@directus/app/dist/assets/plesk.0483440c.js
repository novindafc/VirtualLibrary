import{r as a,p as c,q as d,w as s,z as e,t as r,S as t}from"./vendor.546e1516.js";var h="assets/plesk-screenshot.00f26a33.png";const u={class:"markdown-body"},p=e("p",null,[t("On many shared hosts you are not allowed to directly invoke node commands but you have to use the Plesk configuration panel instead. Unfortunately, Plesk does not allow the interactive execution of node scripts. Therefore we can\u2019t use Directus\u2019 "),e("code",null,"init"),t(" script and have to set up the project by our own.")],-1),_=e("div",{class:"tip hint"},[e("div",{class:"hint-title"},"Successful tests"),e("p",null,"This approach has successfully been tested with a webhosting offer from netcup.")],-1),f=e("h2",{id:"setup-database"},[t("Setup database "),e("a",{class:"header-anchor",href:"#setup-database"},"#")],-1),m=e("p",null,"First, make sure that you\u2019ve already created a database and a user for it. We will use MySQL in this guide. When you plan to use SQLite you can ignore this.",-1),g=e("h2",{id:"setup-a-project-folder"},[t("Setup a project folder "),e("a",{class:"header-anchor",href:"#setup-a-project-folder"},"#")],-1),y=e("p",null,"On the server, create a project folder with 4 files in it.",-1),b=e("h3",{id:"1.-add-.env-file"},[t("1. Add .env file "),e("a",{class:"header-anchor",href:"#1.-add-.env-file"},"#")],-1),v=t("This file is used to configure Directus. Normally, the "),k=e("code",null,"init",-1),w=t(" script would create it for us. So now we have to do it manually. You can just copy it from another Directus installation or use the "),j=e("a",{href:"https://github.com/directus/directus/blob/main/api/example.env",target:"_blank",rel:"noopener noreferrer"},"example file",-1),x=t(" of Directus and then modify it (see "),D=t("Environment Variables"),A=t("). You likely have to adjust the database information."),P=e("p",null,"If you have not already a user in the database make sure to add a first user by adding the following two lines so that you can later login to Directus.",-1),S=e("pre",null,[e("code",null,`ADMIN_EMAIL="admin@example.com"
ADMIN_PASSWORD="password"
`)],-1),T=e("div",{class:"tip hint"},[e("div",{class:"hint-title"},"Choosing a Port"),e("p",null,[t("Since Plesk uses the "),e("a",{href:"https://www.phusionpassenger.com/",target:"_blank",rel:"noopener noreferrer"},"Phusion Passenger"),t(" application server to serve Node.js apps you do not need to worry about choosing a specific port. Just use an arbitrary number. To quote the Passenger docs:")]),e("blockquote",null,[e("p",null,"When run in Passenger, the port number that you pass to listen() is irrelevant and has no effect. Passenger always makes the app listen on a random Unix domain socket.")])],-1),I=e("h3",{id:"2.-add-package.json"},[t("2. Add package.json "),e("a",{class:"header-anchor",href:"#2.-add-package.json"},"#")],-1),N=e("p",null,[t("Add Directus and your database connector as a dependency. To execute Directus\u2019 "),e("code",null,"bootstrap"),t(" command you also have to add a script entry for it.")],-1),W=e("pre",null,[e("code",{class:"language-json"},[t(`{
	`),e("span",{class:"hljs-attr"},'"scripts"'),t(`: {
		`),e("span",{class:"hljs-attr"},'"bootstrap"'),t(": "),e("span",{class:"hljs-string"},'"directus bootstrap"'),t(`
	},
	`),e("span",{class:"hljs-attr"},'"dependencies"'),t(`: {
		`),e("span",{class:"hljs-attr"},'"directus"'),t(": "),e("span",{class:"hljs-string"},'"*"'),t(`,
		`),e("span",{class:"hljs-attr"},'"mysql"'),t(": "),e("span",{class:"hljs-string"},'"^2.18.1"'),t(`
	}
}
`)])],-1),q=e("h3",{id:"3.-add-application-startup-file-index.js"},[t("3. Add application startup file index.js "),e("a",{class:"header-anchor",href:"#3.-add-application-startup-file-index.js"},"#")],-1),Y=e("p",null,[t("Instead of a start command, Plesk wants a startup file. So create a "),e("code",null,"index.js"),t(" with the following content:")],-1),C=e("pre",null,[e("code",{class:"language-js"},[e("span",{class:"hljs-keyword"},"var"),t(" { startServer } = "),e("span",{class:"hljs-built_in"},"require"),t("("),e("span",{class:"hljs-string"},"'directus/server'"),t(`);

startServer();
`)])],-1),L=e("h3",{id:"4.-add-.npmrc"},[t("4. Add .npmrc "),e("a",{class:"header-anchor",href:"#4.-add-.npmrc"},"#")],-1),M=e("p",null,[t("We need to make a small configuration for npm by creating a "),e("code",null,".npmrc"),t(" file with the following content:")],-1),B=e("pre",null,[e("code",null,`scripts-prepend-node-path=true
`)],-1),E=e("h3",{id:"5.-add-document_root-folder"},[t("5. Add document_root folder "),e("a",{class:"header-anchor",href:"#5.-add-document_root-folder"},"#")],-1),O=e("p",null,[t("Lastly, we need to add a "),e("code",null,"document_root"),t(" folder inside our project-directory.")],-1),V=e("p",null,"It\u2019s required by plesk that the document root must be a subdirectory of the application root directory. The folder can stay empty.",-1),U=e("div",{class:"tip hint"},[e("div",{class:"hint-title"},"Store `document_root` in a version control"),e("p",null,[t("If you want to keep the folder in in a version controll like git, create a empty "),e("code",null,".gitignore"),t(" file inside the folder.")])],-1),F=e("h2",{id:"activate-and-configure-node.js"},[t("Activate and configure node.js "),e("a",{class:"header-anchor",href:"#activate-and-configure-node.js"},"#")],-1),Q=e("p",null,"In Plesk, choose your website and click \u201CNode.js\u201D. You should then see a button \u201CEnable Node.js\u201D and click on it.",-1),R=e("p",null,[t("Now, change the \u201CDocument root\u201D and \u201CApplication root\u201D to the location of your project folder. \u201CApplication startup file\u201D must point to the "),e("code",null,"index.js"),t(" file from the former step. The screen should now look like this:")],-1),z=e("p",null,[e("img",{src:h,alt:"Plesk Screenshot"})],-1),H=e("p",null,"You can now install the dependencies by clicking on the button \u201CNPM install\u201D.",-1),J=e("h2",{id:"bootstrap-directus"},[t("Bootstrap Directus "),e("a",{class:"header-anchor",href:"#bootstrap-directus"},"#")],-1),$=e("p",null,[t("To set up the database tables (and the first user) for Directus, click on the button \u201CRun script\u201D and input "),e("code",null,"bootstrap"),t(". You get the console output after the script has run through.")],-1),G=e("div",{class:"tip hint"},[e("div",{class:"hint-title"},"Current Issue of Argon2"),e("p",null,"You may run into an error of argon2 telling you that glibc is missing. If that\u2019s the case try adding and running this script entry to your package.json:"),e("pre",null,[e("code",{class:"language-json"},`    "scripts" {
        "argon2-rebuild": "npm rebuild argon2 --build-from-source",
        <...>
    }

`)]),e("p",null,[t("Afterwards try "),e("code",null,"bootstrap"),t(" again.")])],-1),K=e("h2",{id:"use-snapshots"},[t("Use snapshots "),e("a",{class:"header-anchor",href:"#use-snapshots"},"#")],-1),X=t("On Plesk you can\u2019t directly run an npx command. To use the Directus snapshot feature, you\u2019d need to add a script to your "),Z=e("code",null,"package.json",-1),ee=t(". For snapshot creation you can find an example in the "),te=t("CLI docs: Date-based snapshots"),se=e("p",null,"To apply a snapshot you need a custom wrapper wrapper using the non-interactive version:",-1),oe=e("pre",null,[e("code",{class:"language-json"},`    "scripts" {
    	"apply-snapshot--noninteractive": "npx directus schema apply --yes ./snapshots/\\"$npm_config_filename\\"",
        <...>
    }

`)],-1),ne=e("p",null,"After that you can apply a snapshot by entering the following command to plesk:",-1),ae=e("pre",null,[e("code",{class:"language-sh"},`apply-snapshot--noninteractive --filename=[file.yaml]
`)],-1),re=e("h2",{id:"test-directus-access"},[t("Test Directus Access "),e("a",{class:"header-anchor",href:"#test-directus-access"},"#")],-1),ie=e("p",null,"The Directus app should now work under your configured url. If not, try changing the development mode and wait a couple of seconds.",-1),ue={setup(le,{expose:i}){const o={title:"Shared Hosting with Plesk",modularExtension:!1};return i({frontmatter:o}),(ce,de)=>{const n=a("router-link"),l=a("DocsWrapper");return c(),d(l,{frontmatter:o},{default:s(()=>[e("div",u,[p,_,f,m,g,y,b,e("p",null,[v,k,w,j,x,r(n,{to:"/docs/configuration/config-options/#general"},{default:s(()=>[D]),_:1}),A]),P,S,T,I,N,W,q,Y,C,L,M,B,E,O,V,U,F,Q,R,z,H,J,$,G,K,e("p",null,[X,Z,ee,r(n,{to:"/docs/getting-started/installation/plesk#snapshot-the-data-model"},{default:s(()=>[te]),_:1})]),se,oe,ne,ae,re,ie])]),_:1})}}};export{ue as default};
