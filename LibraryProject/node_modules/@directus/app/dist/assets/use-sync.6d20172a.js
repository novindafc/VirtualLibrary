var G=Object.defineProperty,K=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var R=(e,t,n)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,A=(e,t)=>{for(var n in t||(t={}))Y.call(t,n)&&R(e,n,t[n]);if(N)for(var n of N(t))Z.call(t,n)&&R(e,n,t[n]);return e},M=(e,t)=>K(e,V(t));import{H as P,v as F,o as c,l as I,y as ee,ai as y,ad as q,n as te,ap as ne,a1 as le}from"./vendor.546e1516.js";function ge(e){return e}function Se(e){return e}function be(e){return e}function we(e){return e}function Fe(e){return e}function Ee(e){return e}function Te(e){return e}function $e(e){if(e===null)return[];const t=/{{(.*?)}}/g;let n=e.match(t);return Array.isArray(n)?(n=n.map(i=>i.replace(/{{/g,"").replace(/}}/g,"").trim()),n):[]}function Ce(e){var t,n,i;const{relation:l,collection:a,field:r}=e;return l?l.collection===a&&l.field===r&&((t=l.meta)===null||t===void 0?void 0:t.one_collection_field)&&((n=l.meta)===null||n===void 0?void 0:n.one_allowed_collections)?"m2a":l.collection===a&&l.field===r?"m2o":l.related_collection===a&&((i=l.meta)===null||i===void 0?void 0:i.one_field)===r?"o2m":null:null}const ue="stores",oe="api",ie="extensions";function ae(e,t,n){const i=e[t],l=e.length,a=t-n;if(i===void 0)return e;if(a>0)return[...e.slice(0,n),i,...e.slice(n,t),...e.slice(t+1,l)];if(a<0){const r=n+1;return[...e.slice(0,t),...e.slice(t+1,r),i,...e.slice(r,l)]}return e}function re(){const e=P(ue);if(!e)throw new Error("[useStores]: The stores could not be found.");return e}function se(){const e=P(oe);if(!e)throw new Error("[useApi]: The api could not be found.");return e}function ce(){const e=P(ie);if(!e)throw new Error("[useExtensions]: The extensions could not be found.");return e}function de(e){const{useCollectionsStore:t,useFieldsStore:n}=re(),i=t(),l=n(),a=typeof e=="string"?F(e):e,r=c(()=>i.collections.find(({collection:u})=>u===a.value)||null),h=c(()=>a.value?l.getFieldsForCollection(a.value):[]),T=c(()=>{var u;if(!h.value)return{};const o={};for(const p of h.value)((u=p.schema)===null||u===void 0?void 0:u.default_value)&&(o[p.field]=p.schema.default_value);return o}),$=c(()=>h.value.find(u=>{var o;return u.collection===a.value&&((o=u.schema)===null||o===void 0?void 0:o.is_primary_key)===!0})||null),m=c(()=>{var u;return((u=h.value)===null||u===void 0?void 0:u.find(o=>{var p;return(((p=o.meta)===null||p===void 0?void 0:p.special)||[]).includes("user_created")}))||null}),C=c(()=>{var u,o;return((o=(u=r.value)===null||u===void 0?void 0:u.meta)===null||o===void 0?void 0:o.sort_field)||null}),_=c(()=>{var u,o;return((o=(u=r.value)===null||u===void 0?void 0:u.meta)===null||o===void 0?void 0:o.singleton)===!0}),E=c(()=>!r.value||!r.value.meta?null:r.value.meta.accountability);return{info:r,fields:h,defaults:T,primaryKeyField:$,userCreatedField:m,sortField:C,isSingleton:_,accountabilityScope:E}}function Oe(e,t,n=!0){const i=se(),{primaryKeyField:l}=de(e),{fields:a,limit:r,sort:h,search:T,filter:$,page:m}=t,C=c(()=>e.value?e.value.startsWith("directus_")?`/${e.value.substring(9)}`:`/items/${e.value}`:null),_=F([]),E=F(!1),u=F(null),o=F(null),p=F(null),J=c(()=>{var d,f;return o.value===null||o.value<((d=y(r))!==null&&d!==void 0?d:100)?1:Math.ceil(o.value/((f=y(r))!==null&&f!==void 0?f:100))});let S=null,b=null;const W=I.exports.throttle(x,500);return n&&W(),ee([e,r,h,T,$,a,m],async(d,f)=>{if(I.exports.isEqual(d,f))return;const[v,s,g,w,j,O,pe]=d,[L,Q,X,D,z,me,_e]=f;!v||!t||((!I.exports.isEqual(j,z)||!I.exports.isEqual(g,X)||s!==Q||w!==D)&&L&&(m.value=1),v!==L&&U(),W())},{deep:!0,immediate:!0}),{itemCount:o,totalCount:p,items:_,totalPages:J,loading:E,error:u,changeManualSort:H,getItems:x};async function x(){var d,f;if(!C.value)return;S==null||S.cancel(),S=null,u.value=null,b&&clearTimeout(b),b=setTimeout(()=>{E.value=!0},150);let v=[...(d=y(a))!==null&&d!==void 0?d:[]];!((f=y(a))===null||f===void 0?void 0:f.includes("*"))&&l.value&&v.includes(l.value.field)===!1&&v.push(l.value.field),v=v.filter(s=>s.startsWith("$")===!1);try{S=q.CancelToken.source();const s=await i.get(C.value,{params:{limit:y(r),fields:v,sort:y(h),page:y(m),search:y(T),filter:y($),meta:["filter_count","total_count"]},cancelToken:S.token});let g=s.data.data;e.value==="directus_files"&&(g=g.map(w=>M(A({},w),{$thumbnail:w}))),_.value=g,p.value=s.data.meta.total_count,o.value=s.data.meta.filter_count,m&&g.length===0&&(m==null?void 0:m.value)!==1&&(m.value=1)}catch(s){q.isCancel(s)||(u.value=s)}finally{b&&(clearTimeout(b),b=null),E.value=!1}}function U(){_.value=[],p.value=null,o.value=null}async function H({item:d,to:f}){var v;const s=(v=l.value)===null||v===void 0?void 0:v.field;if(!s)return;const g=_.value.findIndex(O=>O[s]===d),w=_.value.findIndex(O=>O[s]===f);_.value=ae(_.value,g,w);const j=c(()=>`/utils/sort/${e.value}`);await i.post(j.value,{item:d,to:f})}}const k="wrapper",B=["selection","layoutOptions","layoutQuery"];function fe(e){return B.includes(e)}function ve(e){return te({name:`${e.id}-${k}`,props:{collection:{type:String,required:!0},selection:{type:Array,default:()=>[]},layoutOptions:{type:Object,default:()=>({})},layoutQuery:{type:Object,default:()=>({})},filter:{type:Object,default:null},filterUser:{type:Object,default:null},filterSystem:{type:Object,default:null},search:{type:String,default:null},showSelect:{type:String,default:"multiple"},selectMode:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},resetPreset:{type:Function,default:null},clearFilters:{type:Function,default:null}},emits:B.map(t=>`update:${t}`),setup(t,{emit:n}){const i=ne(A(A({},e.setup(t,{emit:n})),le(t)));for(const l in i)i[`onUpdate:${l}`]=a=>{fe(l)?n(`update:${l}`,a):Object.keys(t).includes(l)||(i[l]=a)};return{state:i}},render(t){return t.$slots.default!==void 0?t.$slots.default({layoutState:t.state}):null}})}function Ae(e){const{layouts:t}=ce(),n=c(()=>t.value.map(l=>ve(l)));return{layoutWrapper:c(()=>{const l=n.value.find(a=>a.name===`${e.value}-${k}`);return l===void 0?n.value.find(a=>a.name===`tabular-${k}`):l})}}function Ie(e,t,n){return c({get(){return e[t]},set(i){n(`update:${t}`,i)}})}export{oe as A,ie as E,ue as S,Ae as a,de as b,Ce as c,we as d,Te as e,Se as f,$e as g,ge as h,be as i,Oe as j,Fe as k,Ee as l,re as m,se as n,ce as o,Ie as u};
